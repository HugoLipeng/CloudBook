# Java内存区域

1. 方法区(公有)

   > 用户存储已被虚拟机加载的类信息，常量，静态常量，即时编译器编译后的代码等数据。异常状态OutOfMemoryError。
   >
   > 常量池：用户存放编译器生成的各种字面量和符号引用。

2. 堆(公有) 

   >  JVM所管理的内存中最大的一块。用来存放实例对象，几乎所有的对象实例都在这里分配。Java 堆是垃圾收集器管理的主要区域，因此很多时候也被称为 “GC” 堆。

3. 虚拟机栈(线程私有)

   > 描述Java方法执行的内存模型：每个方法在执行时都会创建一个栈帧，用户存储局部变量表，操作数栈，动态连接，方法出口等信息。每一个方法从调用直至完成的过程，就对应这一个栈帧在虚拟机栈中入栈和出栈的过程。

4. 本地方法栈(线程私有)

   > 与虚拟机栈所发挥的作用相似。区别在于不过是虚拟机栈为虚拟机执行Java方法，而本地方法栈为虚拟机使用到的Native方法服务。

5. 程序计数器(线程私有)

   > 一块较小的内存，当前线程所执行的字节码的行号指示器。字节码解释器工作时，就是通过改变这个计数器的值来选取下一条需要执行的字节码指令。



### Java内存模型

目的是什么？

> 屏蔽掉各种硬件和操作系统的内存访问差异，以实现让java程序在各种平台下都能达到一致的内存访问效果。

它的主要目标是什么？

> 定义程序中变量的访问规则，即在虚拟机中将变量存储到内存和从内存中取出变量这样的底层细节。此处的变量与Java 编程中所说的变量是有所区别，它包括了实例字段，静态字段和构成数组对象的元素，但不包括局部变量和方法参数。

Java内存模型规定了所有的变量都存储在主内存中。每条线程中还有自己的工作内存，线程的工作内存中保存了该线程所使用的到的变量(这些变量是从主内存中拷贝而来)。线程对变量的所有操作(读取，赋值)都必须在工作内存中进行。不同线程之间也无法直接访问对方工作内存中的变量，线程间变量值的传递均需要通过主内存来完成。

![img](E:\Android_NoteBook\Android_NoteBook\assets\3985563-7db5daa99dd1f3c3.png)