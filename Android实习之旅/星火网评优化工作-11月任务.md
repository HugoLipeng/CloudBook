# 星火网评Android端优化工作

优化前的架构图

![image-20191108183854592](https://tva1.sinaimg.cn/large/006y8mN6ly1g8qtg8r82vj318m0u07dq.jpg)



优化后

![image-20191108183928169](https://tva1.sinaimg.cn/large/006y8mN6ly1g8qtgtm0etj311d0u0alz.jpg)





## 优化分析：

1. **项目框架优化**

   ![image-20191108170221211](https://tva1.sinaimg.cn/large/006y8mN6ly1g8qqnr08mfj311c0gkab0.jpg)

   - 原来的框架中，M与P单线关联，由P层调度M，并与View进行通信，由于M不能直接操作P，导致很多逻辑需要在P层处理，增加了P的任务。**改动后，将M与P进行互相关联，从而强化M层的作用。**
   - 原来的框架中，考虑到可能有些时候并不需要M层，M并没有进行封装,需要手动创建接口,手动置null。改动后：**M使用注解进行实例化，并与原有框架融合，减少后续的手动操作**
   - 原来的框架中，有些方法由抽象超类进行管理，并不灵活，后续修改成本较高。改动后：**所有方法采用接口抽离，减少不必要的继承，并建立契约类统一管理**

2. **业务代码优化**

   - 原来的代码中，通讯录，搜索，转发模块复用过深导致的业务链太长，从而后期需求变动，bug修复变的非常麻烦。优化后：**采用策略模式将共用方法抽离成接口，现有的P层持有这个接口，在使用时动态实例化相应的业务类实现接口，相当于P层的一个任务分发。**
   - 原来的消息总线缺乏统一管理，导致后期无法快速定位问题。改动后：**封装EventBus工具类，并将EventBus集成在框架中，动态决定是否需要，并由P层统一管理调度。**

3. **工具优化**

   - 原来的网络请求 Retrofit+Okhttp无法感知生命周期，在请求时如果出现null指针，每次需要手动判断。改动后：**采用LiveData，避免null指针的风险**
   - Dialog目前处于业务层，可以考虑进行一个封装优化。

4. **性能优化**

   App启动时间优化，目前的启动白屏时间过长，需要2秒左右才可进入。优化方案：待研究；

5. **新工具集成**

   - 集成tinker热修复；
   - 集成bugly异常采集框架；





### 工期安排：

##### 框架完善   --3天

**工具优化** --**2天**

**业务代码优化** -1周

##### 新工具集成  --1.5周

1. tinker 研究加总结分享 
2. Bugly,蒲公英打包

**性能优化** --**1天**



### 产出

4-5篇wiki

- Android MVP框架的搭建全过程。
- 策略模式在实际开发中的应用。
- 什么是热修复，Tinker使用总结。(分享)
- ...

 